import{u as e}from"./useId.mjs";import{x as t,d as a,y as o,e as r,P as n}from"../build/server.mjs";import{u}from"./useDirection.mjs";import{d as i,t as s,a as l,A as d,B as c,K as f,u as p,g as v,D as m,c as b,o as y,f as g,n as h}from"../routes/renderer.mjs";const I={bubbles:!1,cancelable:!0},w={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function focusFirst(e,a=!1){const o=t();for(const r of e){if(r===o)return;if(r.focus({preventScroll:a}),t()!==o)return}}const[F,S]=r("RovingFocusGroup");var A=i({__name:"RovingFocusGroup",props:{orientation:{type:String,required:!1,default:void 0},dir:{type:String,required:!1},loop:{type:Boolean,required:!1,default:!1},currentTabStopId:{type:[String,null],required:!1},defaultCurrentTabStopId:{type:String,required:!1},preventScrollOnEntryFocus:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["entryFocus","update:currentTabStopId"],setup(e,{expose:t,emit:r}){const i=e,b=r,{loop:y,orientation:g,dir:h}=s(i),w=u(h),F=a(i,"currentTabStopId",b,{defaultValue:i.defaultCurrentTabStopId,passive:void 0===i.currentTabStopId}),A=l(!1),T=l(!1),q=l(0),{getItems:x,CollectionSlot:K}=o({isProvider:!0});function handleFocus(e){const t=!T.value;if(e.currentTarget&&e.target===e.currentTarget&&t&&!A.value){const t=new CustomEvent("rovingFocusGroup.onEntryFocus",I);if(e.currentTarget.dispatchEvent(t),b("entryFocus",t),!t.defaultPrevented){const e=x().map(e=>e.ref).filter(e=>""!==e.dataset.disabled);focusFirst([e.find(e=>""===e.getAttribute("data-active")),e.find(e=>""===e.getAttribute("data-highlighted")),e.find(e=>e.id===F.value),...e].filter(Boolean),i.preventScrollOnEntryFocus)}}T.value=!1}function handleMouseUp(){setTimeout(()=>{T.value=!1},1)}return t({getItems:x}),S({loop:y,dir:w,orientation:g,currentTabStopId:F,onItemFocus:e=>{F.value=e},onItemShiftTab:()=>{A.value=!0},onFocusableItemAdd:()=>{q.value++},onFocusableItemRemove:()=>{q.value--}}),(e,t)=>(m(),d(p(K),null,{default:c(()=>[f(p(n),{tabindex:A.value||0===q.value?-1:0,"data-orientation":p(g),as:e.as,"as-child":e.asChild,dir:p(w),style:{outline:"none"},onMousedown:t[0]||(t[0]=e=>T.value=!0),onMouseup:handleMouseUp,onFocus:handleFocus,onBlur:t[1]||(t[1]=e=>A.value=!1)},{default:c(()=>[v(e.$slots,"default")]),_:3},8,["tabindex","data-orientation","as","as-child","dir"])]),_:3}))}}),T=i({__name:"RovingFocusItem",props:{tabStopId:{type:String,required:!1},focusable:{type:Boolean,required:!1,default:!0},active:{type:Boolean,required:!1},allowShiftKey:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(t){const a=t,r=F(),u=e(),i=b(()=>a.tabStopId||u),s=b(()=>r.currentTabStopId.value===i.value),{getItems:l,CollectionItem:I}=o();function handleKeydown(e){if("Tab"===e.key&&e.shiftKey)return void r.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,a){const o=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,a);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(o)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(o)))return w[o]}(e,r.orientation.value,r.dir.value);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||!a.allowShiftKey&&e.shiftKey)return;e.preventDefault();let u=[...l().map(e=>e.ref).filter(e=>""!==e.dataset.disabled)];if("last"===t)u.reverse();else if("prev"===t||"next"===t){"prev"===t&&u.reverse();const a=u.indexOf(e.currentTarget);u=r.loop.value?(n=a+1,(o=u).map((e,t)=>o[(n+t)%o.length])):u.slice(a+1)}h(()=>focusFirst(u))}var o,n}return y(()=>{a.focusable&&r.onFocusableItemAdd()}),g(()=>{a.focusable&&r.onFocusableItemRemove()}),(e,t)=>(m(),d(p(I),null,{default:c(()=>[f(p(n),{tabindex:s.value?0:-1,"data-orientation":p(r).orientation.value,"data-active":e.active?"":void 0,"data-disabled":e.focusable?void 0:"",as:e.as,"as-child":e.asChild,onMousedown:t[0]||(t[0]=t=>{e.focusable?p(r).onItemFocus(i.value):t.preventDefault()}),onFocus:t[1]||(t[1]=e=>p(r).onItemFocus(i.value)),onKeydown:handleKeydown},{default:c(()=>[v(e.$slots,"default")]),_:3},8,["tabindex","data-orientation","data-active","data-disabled","as","as-child"])]),_:3}))}});export{w as M,A as R,T as a};
//# sourceMappingURL=RovingFocusItem.mjs.map
