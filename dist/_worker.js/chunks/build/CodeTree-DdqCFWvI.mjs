import{z as e,x as l,e as a,d as t,A as n,P as i,y as r,v as s,u,t as o,j as d}from"./server.mjs";import{u as c}from"../_/useDirection.mjs";import{P as v}from"../_/nitro.mjs";import{a as p,d as f,t as m,c as h,A as g,B as y,K as b,u as k,a1 as x,L as C,g as S,n as V,D as I,y as K,Q as w,Z as B,V as T,W as A,S as L,X as E}from"../routes/renderer.mjs";import{R as _,M as q,a as $}from"../_/RovingFocusItem.mjs";import{c as N}from"../_/index2.mjs";import j from"./CodeIcon-CL4PPUYP.mjs";import"../_/shared.esm-bundler.mjs";import"node:buffer";import"node:timers";import"node:events";import"node:process";import"cloudflare:workers";import"node:async_hooks";import"node:path";import"node:fs/promises";import"node:module";import"../_/useId.mjs";function findValuesBetween(e,l,a){const t=e.findIndex(e=>v(e,l)),n=e.findIndex(e=>v(e,a));if(-1===t||-1===n)return[];const[i,r]=[t,n].sort((e,l)=>e-l);return e.slice(i,r+1)}function handleAndDispatchCustomEvent(e,l,a){const t=a.originalEvent.target,n=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:a});l&&t.addEventListener(e,l,{once:!0}),t.dispatchEvent(n)}function useTypeahead(a){const t=e("",1e3);return{search:t,handleTypeaheadSearch:(e,a)=>{t.value=t.value+e;{const e=l(),n=a.map(e=>({...e,textValue:e.value?.textValue??e.ref.textContent?.trim()??""})),i=n.find(l=>l.ref===e),r=function(e,l,a){const t=l.length>1&&Array.from(l).every(e=>e===l[0]),n=t?l[0]:l,i=a?e.indexOf(a):-1;let r=(s=e,u=Math.max(i,0),s.map((e,l)=>s[(u+l)%s.length]));var s,u;1===n.length&&(r=r.filter(e=>e!==a));const o=r.find(e=>e.toLowerCase().startsWith(n.toLowerCase()));return o!==a?o:void 0}(n.map(e=>e.textValue),t.value,i?.textValue),s=n.find(e=>e.textValue===r);return s&&s.ref.focus(),s?.ref}},resetTypeahead:()=>{t.value=""}}}function flatten(e){return e.reduce((e,l)=>(e.push(l),l.children&&e.push(...flatten(l.children)),e),[])}const[W,R]=a("TreeRoot");var D=f({__name:"TreeRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},items:{type:Array,required:!1},expanded:{type:Array,required:!1},defaultExpanded:{type:Array,required:!1},getKey:{type:Function,required:!0},getChildren:{type:Function,required:!1,default:e=>e.children},selectionBehavior:{type:String,required:!1,default:"toggle"},multiple:{type:Boolean,required:!1,skipCheck:!0},dir:{type:String,required:!1},disabled:{type:Boolean,required:!1},propagateSelect:{type:Boolean,required:!1},bubbleSelect:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"ul"}},emits:["update:modelValue","update:expanded"],setup(e,{emit:a}){const r=e,s=a,{items:u,multiple:o,disabled:d,propagateSelect:v,dir:f,bubbleSelect:K}=m(r),{handleTypeaheadSearch:w}=useTypeahead(),B=c(f),T=p(),A=p(!1),L=n(),E=t(r,"modelValue",s,{defaultValue:r.defaultValue??(o.value?[]:void 0),passive:!0,deep:!0}),$=t(r,"expanded",s,{defaultValue:r.defaultExpanded??[],passive:void 0===r.expanded,deep:!0}),{onSelectItem:N,handleMultipleReplace:j}=function(e,l){const a=p();return{firstValue:a,onSelectItem:(t,n)=>{if(l.multiple&&Array.isArray(e.value))if("replace"===l.selectionBehavior)e.value=[t],a.value=t;else{const l=e.value.findIndex(e=>n(e));e.value=-1!==l?e.value.filter((e,a)=>a!==l):[...e.value,t]}else"replace"===l.selectionBehavior?e.value={...t}:!Array.isArray(e.value)&&n(e.value)?e.value=void 0:e.value={...t};return e.value},handleMultipleReplace:function(t,n,i,r){if(!a?.value||!l.multiple||!Array.isArray(e.value))return;const s=i().filter(e=>""!==e.ref.dataset.disabled),u=s.find(e=>e.ref===n)?.value;if(!u)return;let o=null;switch(t){case"prev":case"next":o=findValuesBetween(r,a.value,u);break;case"first":o=findValuesBetween(r,a.value,r?.[0]);break;case"last":o=findValuesBetween(r,a.value,r?.[r.length-1])}e.value=o}}}(E,r),W=h(()=>o.value&&Array.isArray(E.value)?E.value.map(e=>r.getKey(e)):[r.getKey(E.value??{})]);function flattenItems(e,l=1,a){return e.reduce((t,n,i)=>{const s=r.getKey(n),u=r.getChildren(n),o=$.value.includes(s),d={_id:s,value:n,index:i,level:l,parentItem:a,hasChildren:!!u,bind:{value:n,level:l,"aria-setsize":e.length,"aria-posinset":i+1}};return t.push(d),u&&o&&t.push(...flattenItems(u,l+1,n)),t},[])}const D=h(()=>{const e=r.items;return $.value.map(e=>e),flattenItems(e??[])});function handleKeydown(e){if(A.value)L.trigger(e);else{const l=T.value?.getItems()??[];w(e.key,l)}}function handleKeydownNavigation(e){if(A.value)return;const a=q[e.key];V(()=>{j(a,l(),T.value?.getItems,D.value.map(e=>e.value))})}function handleBubbleSelect(e){if(null!=e.parentItem&&Array.isArray(E.value)&&r.multiple){const l=D.value.find(l=>null!=e.parentItem&&r.getKey(l.value)===r.getKey(e.parentItem));if(null!=l){const e=r.getChildren(l.value)?.every(e=>E.value.find(l=>r.getKey(l)===r.getKey(e)));E.value=e?[...E.value,l.value]:E.value.filter(e=>r.getKey(e)!==r.getKey(l.value)),handleBubbleSelect(l)}}}return R({modelValue:E,selectedKeys:W,onSelect:e=>{const condition=l=>r.getKey(l??{})===r.getKey(e),l=r.multiple&&Array.isArray(E.value)?-1!==E.value?.findIndex(condition):void 0;if(N(e,condition),r.bubbleSelect&&r.multiple&&Array.isArray(E.value)){const l=D.value.find(l=>r.getKey(l.value)===r.getKey(e));null!=l&&handleBubbleSelect(l)}if(r.propagateSelect&&r.multiple&&Array.isArray(E.value)){const a=flatten(r.getChildren(e)??[]);E.value=l?[...E.value].filter(e=>!a.some(l=>r.getKey(e??{})===r.getKey(l))):[...E.value,...a]}},expanded:$,onToggle(e){if(!(e?r.getChildren(e):void 0))return;const l=r.getKey(e)??e;$.value.includes(l)?$.value=$.value.filter(e=>e!==l):$.value.push(l)},getKey:r.getKey,getChildren:r.getChildren,items:u,expandedItems:D,disabled:d,multiple:o,dir:B,propagateSelect:v,bubbleSelect:K,isVirtual:A,virtualKeydownHook:L,handleMultipleReplace:j}),(e,l)=>(I(),g(k(_),{ref_key:"rovingFocusGroupRef",ref:T,"as-child":"",orientation:"vertical",dir:k(B)},{default:y(()=>[b(k(i),{role:"tree",as:e.as,"as-child":e.asChild,"aria-multiselectable":!!k(o)||void 0,onKeydown:[handleKeydown,x(C(handleKeydownNavigation,["shift"]),["up","down"])]},{default:y(()=>[S(e.$slots,"default",{flattenItems:D.value,modelValue:k(E),expanded:k($)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}});var P=f({inheritAttrs:!1,__name:"TreeItem",props:{value:{type:null,required:!0},level:{type:Number,required:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"li"}},emits:["select","toggle"],setup(e,{expose:a,emit:t}){const n=e,s=t,u=W(),{getItems:o}=r(),d=h(()=>!!u.getChildren(n.value)),c=h(()=>{const e=u.getKey(n.value);return u.expanded.value.includes(e)}),v=h(()=>{const e=u.getKey(n.value);return u.selectedKeys.value.includes(e)}),p=h(()=>{if(u.bubbleSelect.value&&d.value&&Array.isArray(u.modelValue.value)){const e=flatten(u.getChildren(n.value)||[]);return e.some(e=>u.modelValue.value.find(l=>u.getKey(l)===u.getKey(e)))&&!e.every(e=>u.modelValue.value.find(l=>u.getKey(l)===u.getKey(e)))}if(u.propagateSelect.value&&v.value&&d.value&&Array.isArray(u.modelValue.value)){return!flatten(u.getChildren(n.value)||[]).every(e=>u.modelValue.value.find(l=>u.getKey(l)===u.getKey(e)))}});function handleKeydownRight(e){if(d.value)if(c.value){const e=o().map(e=>e.ref),a=l(),t=e.indexOf(a),i=[...e].slice(t).find(e=>Number(e.getAttribute("data-indent"))===n.level+1);i&&i.focus()}else handleToggleCustomEvent(e)}function handleKeydownLeft(e){if(c.value)handleToggleCustomEvent(e);else{const e=o().map(e=>e.ref),a=l(),t=e.indexOf(a),i=[...e].slice(0,t).reverse().find(e=>Number(e.getAttribute("data-indent"))===n.level-1);i&&i.focus()}}async function handleSelect(e){s("select",e),e?.defaultPrevented||u.onSelect(n.value)}async function handleToggle(e){s("toggle",e),e?.defaultPrevented||u.onToggle(n.value)}async function handleSelectCustomEvent(e){if(!e)return;handleAndDispatchCustomEvent("tree.select",handleSelect,{originalEvent:e,value:n.value,isExpanded:c.value,isSelected:v.value})}async function handleToggleCustomEvent(e){if(!e)return;handleAndDispatchCustomEvent("tree.toggle",handleToggle,{originalEvent:e,value:n.value,isExpanded:c.value,isSelected:v.value})}return a({isExpanded:c,isSelected:v,isIndeterminate:p,handleToggle:()=>u.onToggle(n.value),handleSelect:()=>u.onSelect(n.value)}),(e,l)=>(I(),g(k($),{"as-child":"",value:e.value,"allow-shift-key":""},{default:y(()=>[b(k(i),K(e.$attrs,{role:"treeitem",as:e.as,"as-child":e.asChild,"aria-selected":v.value,"aria-expanded":d.value?c.value:void 0,"aria-level":e.level,"data-indent":e.level,"data-selected":v.value?"":void 0,"data-expanded":c.value?"":void 0,onKeydown:[x(C(handleSelectCustomEvent,["self","prevent"]),["enter","space"]),l[0]||(l[0]=x(C(e=>"ltr"===k(u).dir.value?handleKeydownRight(e):handleKeydownLeft(e),["prevent"]),["right"])),l[1]||(l[1]=x(C(e=>"ltr"===k(u).dir.value?handleKeydownLeft(e):handleKeydownRight(e),["prevent"]),["left"]))],onClick:l[2]||(l[2]=C(e=>{handleSelectCustomEvent(e),handleToggleCustomEvent(e)},["stop"]))}),{default:y(()=>[S(e.$slots,"default",{isExpanded:c.value,isSelected:v.value,isIndeterminate:p.value,handleSelect:()=>k(u).onSelect(e.value),handleToggle:()=>k(u).onToggle(e.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}});const M={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},O=Object.assign({inheritAttrs:!1},{__name:"ProseCodeTree",__ssrInlineRender:!0,props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(e){const l=e,a=s.useSlots(),t=u(),[n,i]=N(),r=s.computed(()=>o({extend:o(M),...t.ui?.prose?.codeTree||{}})()),c=s.ref(l.defaultValue?{path:l.defaultValue}:void 0),v=s.ref(),p=s.ref(1),f=s.computed(()=>(p.value,a.default?.()?.flatMap(transformSlot).filter(Boolean)||[])),m=s.computed(()=>function(e){const l=new Map,a=[];e.forEach(e=>{const t=e.label.split("/");let n="";t.forEach((e,i)=>{if(n=n?`${n}/${e}`:e,!l.has(n)){const r={label:e,path:n,...i<t.length-1&&{children:[]}};l.set(n,r),0===i?a.push(r):l.get(t.slice(0,i).join("/"))?.children?.push(r)}})});const sort=e=>e.sort((e,l)=>!!e.children==!!l.children?e.label.localeCompare(l.label):l.children?1:-1).map(e=>({...e,children:e.children&&sort(e.children)}));return sort(a)}(f.value));function transformSlot(e,l){return"symbol"==typeof e.type?e.children?.map(transformSlot):{label:e.props?.filename||e.props?.label||`${l}`,icon:e.props?.icon,component:e}}const h=s.computed(()=>{if(l.expandAll){const e=new Set;return f.value.forEach(l=>{const a=l.label.split("/");for(let l=1;l<a.length;l++)e.add(a.slice(0,l).join("/"))}),Array.from(e)}const e=c.value?.path;if(!e)return[];const a=e.split("/");return a.map((e,l)=>a.slice(0,l+1).join("/"))});return s.watch(c,e=>{const l=f.value.find(l=>e?.path===l.label);l?.component&&(v.value=l)},{immediate:!0}),(e,a,u,o)=>{a("\x3c!--[--\x3e"),a(w(s.unref(n),null,{default:s.withCtx(({items:e,level:a},n,u,o)=>{if(!n)return[(s.openBlock(!0),s.createBlock(s.Fragment,null,s.renderList(e,(e,n)=>(s.openBlock(),s.createBlock("li",{key:`${a}-${n}`,role:"presentation",class:a>1?r.value.itemWithChildren({class:l.ui?.itemWithChildren}):r.value.item({class:l.ui?.item})},[s.createVNode(s.unref(P),{level:a,value:e,"as-child":""},{default:s.withCtx(({isExpanded:n,isSelected:u})=>[s.createVNode("button",{type:"button",class:r.value.link({class:l.ui?.link,active:u})},[e.children?.length?(s.openBlock(),s.createBlock(d,{key:0,name:n?s.unref(t).ui.icons.folderOpen:s.unref(t).ui.icons.folder,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,8,["name","class"])):(s.openBlock(),s.createBlock(j,{key:1,filename:e.label,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,8,["filename","class"])),s.createVNode("span",{class:r.value.linkLabel({class:l.ui?.linkLabel})},s.toDisplayString(e.label),3),e.children?.length?(s.openBlock(),s.createBlock("span",{key:2,class:r.value.linkTrailing({class:l.ui?.linkTrailing})},[s.createVNode(d,{name:s.unref(t).ui.icons.chevronDown,class:r.value.linkTrailingIcon({class:l.ui?.linkTrailingIcon})},null,8,["name","class"])],2)):s.createCommentVNode("",!0)],2),e.children?.length&&n?(s.openBlock(),s.createBlock("ul",{key:0,role:"group",class:r.value.listWithChildren({class:l.ui?.listWithChildren})},[s.createVNode(s.unref(i),{items:e.children,level:a+1},null,8,["items","level"])],2)):s.createCommentVNode("",!0)]),_:2},1032,["level","value"])],2))),128))];n("\x3c!--[--\x3e"),B(e,(e,c)=>{n(`<li role="presentation" class="${A(a>1?r.value.itemWithChildren({class:l.ui?.itemWithChildren}):r.value.item({class:l.ui?.item}))}"${o}>`),n(w(s.unref(P),{level:a,value:e,"as-child":""},{default:s.withCtx(({isExpanded:n,isSelected:u},o,c,v)=>{if(!o)return[s.createVNode("button",{type:"button",class:r.value.link({class:l.ui?.link,active:u})},[e.children?.length?(s.openBlock(),s.createBlock(d,{key:0,name:n?s.unref(t).ui.icons.folderOpen:s.unref(t).ui.icons.folder,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,8,["name","class"])):(s.openBlock(),s.createBlock(j,{key:1,filename:e.label,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,8,["filename","class"])),s.createVNode("span",{class:r.value.linkLabel({class:l.ui?.linkLabel})},s.toDisplayString(e.label),3),e.children?.length?(s.openBlock(),s.createBlock("span",{key:2,class:r.value.linkTrailing({class:l.ui?.linkTrailing})},[s.createVNode(d,{name:s.unref(t).ui.icons.chevronDown,class:r.value.linkTrailingIcon({class:l.ui?.linkTrailingIcon})},null,8,["name","class"])],2)):s.createCommentVNode("",!0)],2),e.children?.length&&n?(s.openBlock(),s.createBlock("ul",{key:0,role:"group",class:r.value.listWithChildren({class:l.ui?.listWithChildren})},[s.createVNode(s.unref(i),{items:e.children,level:a+1},null,8,["items","level"])],2)):s.createCommentVNode("",!0)];o(`<button type="button" class="${A(r.value.link({class:l.ui?.link,active:u}))}"${v}>`),e.children?.length?o(w(d,{name:n?s.unref(t).ui.icons.folderOpen:s.unref(t).ui.icons.folder,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,c,v)):o(w(j,{filename:e.label,class:r.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon})},null,c,v)),o(`<span class="${A(r.value.linkLabel({class:l.ui?.linkLabel}))}"${v}>${E(e.label)}</span>`),e.children?.length?(o(`<span class="${A(r.value.linkTrailing({class:l.ui?.linkTrailing}))}"${v}>`),o(w(d,{name:s.unref(t).ui.icons.chevronDown,class:r.value.linkTrailingIcon({class:l.ui?.linkTrailingIcon})},null,c,v)),o("</span>")):o("\x3c!----\x3e"),o("</button>"),e.children?.length&&n?(o(`<ul role="group" class="${A(r.value.listWithChildren({class:l.ui?.listWithChildren}))}"${v}>`),o(w(s.unref(i),{items:e.children,level:a+1},null,c,v)),o("</ul>")):o("\x3c!----\x3e")}),_:2},u,o)),n("</li>")}),n("\x3c!--]--\x3e")}),_:1},u)),a(`<div${T(s.mergeProps(e.$attrs,{class:r.value.root({class:[l.ui?.root,l.class]})}))}>`),a(w(s.unref(D),{modelValue:c.value,"onUpdate:modelValue":e=>c.value=e,class:r.value.list({class:l.ui?.list}),items:m.value,"get-key":e=>e.path,"default-expanded":h.value},{default:s.withCtx((e,l,a,t)=>{if(!l)return[s.createVNode(s.unref(i),{items:m.value,level:1},null,8,["items"])];l(w(s.unref(i),{items:m.value,level:1},null,a,t))}),_:1},u)),a(`<div class="${A(r.value.content({class:l.ui?.content}))}">`),L(a,s.createVNode(s.resolveDynamicComponent(v.value?.component),null,null),u),a("</div></div>\x3c!--]--\x3e")}}}),z=O.setup;O.setup=(e,l)=>{const a=s.useSSRContext();return(a.modules||(a.modules=new Set)).add("../node_modules/@nuxt/ui/dist/runtime/components/prose/CodeTree.vue"),z?z(e,l):void 0};export{O as default};
//# sourceMappingURL=CodeTree-DdqCFWvI.mjs.map
